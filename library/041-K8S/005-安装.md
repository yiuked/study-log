#### Master

Master上的etcd、kube-apiserver、kube-controller-manager、kube-scheduler服务

#### Node

Node 上的 kubelet、kube-proxy服务

### 准备

```
swapoff -a
vim /etc/fstab
# 注释以下这行
#/dev/mapper/centos-swap swap                    swap    defaults        0 0

# 查看是否修改成功
free -m 

# docker Cgroup Driver: cgroupfs

cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system
```

```
systemctl daemon-reload
systemctl restart kubelet
```



### 安装 `kubelet kubeadm kubectl`

```
cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-$basearch
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF
```

```
cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
```

```
systemctl enable kubelet.service
```



### 创建集群

1、如果能访问外网，使用如下：

```
kubeadm init \
--control-plane-endpoint "192.168.3.99:6443" \
--pod-network-cidr=192.168.0.0/16 \
--apiserver-advertise-address=192.168.3.99
```

2、如果不能访问外网，使用如下：

```
kubeadm init --image-repository registry.aliyuncs.com/google_containers \
--control-plane-endpoint "192.168.3.99:6443" \
--pod-network-cidr=192.168.0.0/16 \
--apiserver-advertise-address=192.168.3.99
```
