## P2P网络详解

### 关于NAT的背景
NAT的作用NAT(Network Address Translator)，网络地址转换。它是一种把内部私有网络IP地址翻译成公有网络IP地址的技术，如图5-1所示。NAT是在IP地址日益缺乏的情况下产生的，它的主要目的是使地址能够重用。

内网主机用私有地址在内网能与其它的内网主机无误地通信，但它不能直接用私有地址访问外网的主机，因为私有地址不能被路由。它要与外网通信，必须经过NAT设备（如网关，路由器）。

NAT 分为Basic NAT与 NAPT(Network Address/Port Translator)，Basic NAT不能够进行TCP/UDP的端口信息转换
因此目前使用比较少，目前应用比较广的为NAPT。

NAT 的全工作流程如下:
```flow
client=>start: 客户端(私网：192.168.1.10:4300)
nats=>operation: NAT网关(公网：114.152.136.25) - 将 192.168.1.10:4300 转换为 114.152.136.25:5300
nat=>condition:NAT网关(公网：114.152.136.25)
server=>end: 服务端(公网：223.15.49.25:3360)

client->nat(yes)->server

```


https://www.cnblogs.com/general0878/p/5076470.html

NAT(Network Address Translators)，网络地址转换：网络地址转换是在IP地址日益缺乏的情况下产生的，它的主要目的就是为了能够地址重用。NAT从历史发展上分为两大类，基本的NAT和NAPT(Network Address/Port Translator)。
  最先提出的是基本的NAT(peakflys注：刚开始其实只是路由器上的一个功能模块)，它的产生基于如下事实：一个私有网络（域）中的节点中只有很少的节点需要与外网连接（这是在上世纪90年代中期提出的）。那么这个子网中其实只有少数的节点需要全球唯一的IP地址，其他的节点的IP地址应该是可以重用的。
因此，基本的NAT实现的功能很简单，在子网内使用一个保留的IP子网段，这些IP对外是不可见的。子网内只有少数一些IP地址可以对应到真正全球唯一的IP地址。如果这些节点需要访问外部网络，那么基本NAT就负责将这个节点的子网内IP转化为一个全球唯一的IP然后发送出去。

比特币和以太坊均使用了 UPnP 协议作为局域网穿透工具，只要局域网中的路由设备支持 NAT 网关功能、支持 UPnP 协议，即可将你的区块链节点自动映射到公网上。
