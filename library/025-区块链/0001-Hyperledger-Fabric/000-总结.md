本文水份很严重，如果你正处于配置fabric的环境而翻了一遍又一遍的网文的过程，
那么本文可能并不会帮你解决你当前的紧要问题。

### 准备二进制文件
在我们准备开始之前，我们需要获得以下二进制文件:
```
configtxgen
cryptogen
orderer
peer
configtxlator(非必须)
discover(非必须)
idemixgen(非必须)
fabric-ca-client(非必须)
```
二进制文件，我们可以通过官方的源码自己编译得到`https://github.com/hyperledger/fabric`，
但是这个过程显得比较麻烦，你可能需要一个一个工具去编译。

当然，繁锁的工序并不是主要原因，让我编译不下去的主要原因是因为编译过程
需要从`golang.org`和`google.golang.org`获取大量的依赖包，
而不巧这两个网站正好被墙了，作为深知党的良苦用心以及没钱买梯子的我，就此放弃了此条道路。  

除了自己手动编译，从Fabric的官方文档找到了另一种方法[Install Samples, Binaries and Docker Images](https://hyperledger-fabric.readthedocs.io/en/latest/install.html)，如果你和我一样，一直饱受E文的折磨，那你可以略过大部分的内容，但应该可以找到以下链接:
```
https://raw.githubusercontent.com/hyperledger/fabric/master/scripts/bootstrap.sh
```
当然，你可能会遇到和我一样的情况，那就是`raw.githubusercontent.com`也被墙了，怎么办？

我试着修改hosts文件，于是通过以下链接查询了一下该域名的原始IP地址，修改完成后，竟然可以访问
```
http://ip.webmasterhome.cn/?ip=raw.githubusercontent.com
# 得到的IP地址为:151.101.108.133
```
>PS:golang.org也试过，但修改后也访问不了.

那么终于顺序的得到了`bootstrap.sh`文件,我在这个文件找到了heyperledger fabric的二进制文件下载地址:[hyperledger-fabric-linux-amd64-1.4.3.tar.gz](https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.4.3/hyperledger-fabric-linux-amd64-1.4.3.tar.gz)，如果文件地址已经访问不了，可以试试把文件名去掉，
访问目录，可能会显示可下载的文件列表。
>PS:nexus.hyperledger.org没有被墙，应该可以正常下载`hyperledger-fabric-linux-amd64-1.4.3.tar.gz`文件。  
不过速度可能不敢恭维，为了备用，我把它放了在百度网盘: https://pan.baidu.com/s/13X49PZdIdiPTgQXuud3MfA 提取码: e592  
（别再抱怨了，虽然我很厌恶为了下载一个文件，还必须得下载一个百度网盘。）  

最后终于得到我们所需求的二进制文件。
```
fabric/
├── bin
│   ├── configtxgen
│   ├── configtxlator
│   ├── cryptogen
│   ├── discover
│   ├── idemixgen
│   ├── orderer
│   └── peer
└── config
    ├── configtx.yaml
    ├── core.yaml
    └── orderer.yaml
```
> 记得将bin目录下的文件修改为可执行。同时设置环境变量`export FABRIC_CFG_PATH=/var/fabric/config`

### 整体流程
1. 通过cryptogen生成证书文件。
2. 通过configtxgen生成创世块、channel管道配置文件、anchor锚点配置文件。
3. 启动orderer节点。
4. 通过peer节点创建channel管道。
5. 通过peer节点加入channel管道。
6. 通过peer节点更新锚点信息。
7. 通过peer节点安装链码。
8. 通过peer节点实例化链码。
9. 通过客户端操作交易。

### 生成证书文件
证书的作用在于节点在参与区块链网络工作时，为节点提供身份证明、签名等。它可以通过`cryptogen`与`Fabirc CA`来生成，
本文以`cryptogen`做为示例。

生成证书前，首先需要准备一个配置文件，从刚下载的二进制文件包，并没有该配置文件，因为`cryptogen`已经提供了一个模板。
```
./bin/cryptogen showtemplate>>config/crypto-config.yaml
```
通过以上命令，我们得到了一个配置文件模板。
```
OrdererOrgs:
  - Name: Orderer              # 组织名
    Domain: example.com        # 组织域名
    EnableNodeOUs: true        # 设置为true时，会在证书目录生成config.yaml
    Specs:
      - Hostname: orderer      # 域名前缀,此处节点将生成`orderer.example.com`,设置多个Hostname时，生成多个节点。

PeerOrgs:
  - Name: Org1                 # 组织名
    Domain: org1.example.com   # 组织域名
    EnableNodeOUs: true        # 设置为true时，会在证书目录生成config.yaml
    Template:
      Count: 1                 # 生成的节点数
    Users:
      Count: 1                 # 生成的用户数
```
